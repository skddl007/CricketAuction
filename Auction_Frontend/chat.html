<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat - IPL Auction Strategist</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Poppins', sans-serif;
            background: #F5F5F5;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Left Sidebar */
        .sidebar {
            width: 320px;
            background: #FFFFFF;
            border-right: 1px solid #E0E0E0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid #E0E0E0;
        }

        .logo-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1B5E20, #0D4A10);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
            flex-shrink: 0;
        }

        .sidebar-title {
            font-size: 18px;
            font-weight: 600;
            color: #212121;
            flex: 1;
        }

        .sidebar-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #757575;
            transition: all 0.2s;
        }

        .icon-btn:hover {
            background: #F5F5F5;
            color: #212121;
        }

        .nav-menu {
            padding: 20px;
            border-bottom: 1px solid #E0E0E0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            color: #212121;
            text-decoration: none;
            transition: all 0.2s;
            margin-bottom: 4px;
        }

        .nav-item:hover {
            background: #F5F5F5;
        }

        .nav-item i {
            width: 20px;
            color: #757575;
        }

        .recent-chats {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .recent-chats-title {
            font-size: 12px;
            font-weight: 600;
            color: #9E9E9E;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }

        .chat-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 4px;
            position: relative;
        }

        .chat-item:hover {
            background: #F5F5F5;
        }

        .chat-item-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #E0E0E0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #757575;
            flex-shrink: 0;
        }

        .chat-item-content {
            flex: 1;
            min-width: 0;
        }

        .chat-item-title {
            font-size: 14px;
            font-weight: 500;
            color: #212121;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-item-date {
            font-size: 12px;
            color: #9E9E9E;
        }

        .chat-item-menu {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            cursor: pointer;
            color: #757575;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .chat-item:hover .chat-item-menu {
            opacity: 1;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: #FFFFFF;
        }

        .chat-top-bar {
            padding: 16px 24px;
            border-bottom: 1px solid #E0E0E0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #FFFFFF;
        }

        .team-context-info {
            font-size: 14px;
            color: #757575;
        }

        .select-team-btn {
            padding: 8px 16px;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            background: #FFFFFF;
            color: #212121;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .select-team-btn:hover {
            background: #F5F5F5;
            border-color: #BDBDBD;
        }

        .chat-messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            background: #FAFAFA;
        }

        .chat-message {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            align-items: flex-start;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1B5E20, #0D4A10);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
            flex-shrink: 0;
        }

        .message-bubble {
            background: #FFFFFF;
            padding: 16px;
            border-radius: 12px;
            max-width: 70%;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .message-content {
            font-size: 14px;
            color: #212121;
            line-height: 1.6;
        }

        .message-timestamp {
            font-size: 12px;
            color: #9E9E9E;
            margin-top: 8px;
        }

        .chat-input-area {
            padding: 20px 24px;
            border-top: 1px solid #E0E0E0;
            background: #FFFFFF;
        }

        .suggested-topics {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .suggested-topics::-webkit-scrollbar {
            height: 4px;
        }

        .suggested-topics::-webkit-scrollbar-thumb {
            background: #E0E0E0;
            border-radius: 2px;
        }

        .topic-btn {
            padding: 8px 16px;
            border: 1px solid #E0E0E0;
            border-radius: 20px;
            background: #FFFFFF;
            color: #212121;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .topic-btn:hover {
            background: #F5F5F5;
        }

        .topic-btn.active {
            background: #35cc69;
            color: #FFFFFF;
            border-color: #4fe26d;
        }

        .input-container {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .chat-input-wrapper {
            flex: 1;
            position: relative;
        }

        .chat-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #E0E0E0;
            border-radius: 12px;
            font-size: 14px;
            font-family: inherit;
            resize: none;
            min-height: 48px;
            max-height: 120px;
            transition: all 0.2s;
        }

        .chat-input:focus {
            outline: none;
            border-color: #1B5E20;
            box-shadow: 0 0 0 3px rgba(27, 94, 32, 0.1);
        }

        .input-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .attach-btn {
            width: 40px;
            height: 40px;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            background: #FFFFFF;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #757575;
            transition: all 0.2s;
        }

        .attach-btn:hover {
            background: #F5F5F5;
            border-color: #BDBDBD;
        }

        .send-btn {
            width: 48px;
            height: 48px;
            border: none;
            border-radius: 50%;
            background: #49b680;
            color: #FFFFFF;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
        }

        .send-btn:hover {
            background: #4bcd81;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
        }

        .send-btn:active {
            transform: translateY(0);
        }

        /* Welcome Message */
        .welcome-message {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        /* Team Selector Modal */
        .team-selector-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .team-selector-modal.active {
            display: flex;
        }

        .team-selector-content {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
        }

        .team-selector-content h3 {
            margin-bottom: 16px;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .team-option {
            padding: 12px;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .team-option:hover {
            background: #F5F5F5;
            border-color: #1B5E20;
        }

        .team-option.selected {
            background: #1B5E20;
            color: #FFFFFF;
            border-color: #1B5E20;
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -320px;
                z-index: 100;
                transition: left 0.3s;
            }

            .sidebar.open {
                left: 0;
            }

            .main-content {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Left Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo-circle">CA</div>
            <div class="sidebar-title">CricketAuction</div>
            <div class="sidebar-actions">
                <button class="icon-btn" onclick="startNewChat()" title="New Chat">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="icon-btn" onclick="closeSidebar()" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <nav class="nav-menu">
            <a href="index.html" class="nav-item">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="team-analysis.html" class="nav-item">
                <i class="fas fa-th-large"></i>
                <span>Team Analysis</span>
            </a>
            <a href="recommender.html" class="nav-item">
                <i class="fas fa-chart-bar"></i>
                <span>Recommender</span>
            </a>
        </nav>

        <div class="recent-chats">
            <div class="recent-chats-title">Recent Chats</div>
            <div id="recent-chats-list">
                <!-- Recent chats will be populated here -->
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="chat-top-bar">
            <div class="team-context-info">
                Team context: <span id="selected-team-display">Not set</span>
            </div>
            <button class="select-team-btn" onclick="openTeamSelector()">Select team</button>
        </div>

        <!-- Chat Messages Area -->
        <div class="chat-messages-area" id="chat-messages-area">
            <div class="welcome-message">
                <div class="message-avatar">CA</div>
                <div class="message-bubble">
                    <div class="message-content">
                        Hello! I'm your Cricket Auction assistant. I can help you analyze player performance, match statistics, team strategies, and much more. What would you like to know about your cricket auction data?
                    </div>
                    <div class="message-timestamp" id="welcome-timestamp"></div>
                </div>
            </div>
        </div>

        <!-- Chat Input Area -->
        <div class="chat-input-area">
            <div class="suggested-topics" id="suggested-topics">
                <button class="topic-btn active" data-topic="Top Players">Top Players</button>
                <button class="topic-btn" data-topic="Defense Analysis">Defense Analysis</button>
                <button class="topic-btn" data-topic="Match Trends">Match Trends</button>
                <button class="topic-btn" data-topic="Team Stats">Team Stats</button>
                <button class="topic-btn" data-topic="Auction Analysis">Auction Analysis</button>
            </div>
            <div class="input-container">
                <div class="chat-input-wrapper">
                    <textarea 
                        id="chat-input" 
                        class="chat-input" 
                        placeholder="Ask about player stats, match analysis, team performance..."
                        rows="1"
                    ></textarea>
                </div>
                <div class="input-actions">
                    <button class="attach-btn" title="Attach file">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <button class="send-btn" id="send-btn" onclick="sendMessage()" title="Send">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Team Selector Modal -->
    <div class="team-selector-modal" id="team-selector-modal">
        <div class="team-selector-content">
            <h3>Select Team</h3>
            <div class="team-grid" id="team-grid">
                <!-- Teams will be populated here -->
            </div>
            <div style="display: flex; gap: 8px; justify-content: flex-end;">
                <button class="select-team-btn" onclick="closeTeamSelector()">Cancel</button>
                <button class="select-team-btn" style="background: #1B5E20; color: white; border-color: #1B5E20;" onclick="confirmTeamSelection()">Confirm</button>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/main.js"></script>
    <script src="js/animations.js"></script>
    <script src="js/chat.js"></script>
    <script>
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Set welcome timestamp
            document.getElementById('welcome-timestamp').textContent = new Date().toLocaleTimeString();
            
            // Initialize chat
            if (typeof initializeChatInterface === 'function') {
                initializeChatInterface();
            }
            
            // Initialize team selector
            initializeTeamSelectorModal();
            
            // Initialize recent chats
            loadRecentChats();
            
            // Auto-resize textarea
            const chatInput = document.getElementById('chat-input');
            chatInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });
            
            // Handle Enter key (Shift+Enter for new line)
            chatInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Handle topic buttons
            document.querySelectorAll('.topic-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.topic-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        });

        let selectedTeamForModal = null;

        function initializeTeamSelectorModal() {
            const teams = ['CSK', 'RCB', 'MI', 'KKR', 'DC', 'GT', 'LSG', 'PBKS', 'RR', 'SRH'];
            const teamGrid = document.getElementById('team-grid');
            
            teams.forEach(team => {
                const teamOption = document.createElement('div');
                teamOption.className = 'team-option';
                teamOption.textContent = team;
                teamOption.onclick = () => {
                    document.querySelectorAll('.team-option').forEach(opt => opt.classList.remove('selected'));
                    teamOption.classList.add('selected');
                    selectedTeamForModal = team;
                };
                teamGrid.appendChild(teamOption);
            });
        }

        function openTeamSelector() {
            document.getElementById('team-selector-modal').classList.add('active');
        }

        function closeTeamSelector() {
            document.getElementById('team-selector-modal').classList.remove('active');
            selectedTeamForModal = null;
            document.querySelectorAll('.team-option').forEach(opt => opt.classList.remove('selected'));
        }

        function confirmTeamSelection() {
            if (selectedTeamForModal) {
                if (typeof selectedTeam !== 'undefined') {
                    selectedTeam = selectedTeamForModal;
                }
                document.getElementById('selected-team-display').textContent = selectedTeamForModal;
                closeTeamSelector();
            }
        }

        function startNewChat() {
            if (typeof clearChatHistory === 'function') {
                clearChatHistory();
            }
            const chatArea = document.getElementById('chat-messages-area');
            chatArea.innerHTML = `
                <div class="welcome-message">
                    <div class="message-avatar">CA</div>
                    <div class="message-bubble">
                        <div class="message-content">
                            Hello! I'm your Cricket Auction assistant. I can help you analyze player performance, match statistics, team strategies, and much more. What would you like to know about your cricket auction data?
                        </div>
                        <div class="message-timestamp">${new Date().toLocaleTimeString()}</div>
                    </div>
                </div>
            `;
        }

        function closeSidebar() {
            if (window.innerWidth <= 768) {
                document.querySelector('.sidebar').classList.remove('open');
            }
        }

        function loadRecentChats() {
            const recentChatsList = document.getElementById('recent-chats-list');
            const savedChats = JSON.parse(localStorage.getItem('recentChats') || '[]');
            
            if (savedChats.length === 0) {
                // Add some default recent chats
                const defaultChats = [
                    { title: 'Show me top performin...', date: new Date().toLocaleDateString() },
                    { title: 'Compare match perfor...', date: new Date(Date.now() - 86400000).toLocaleDateString() }
                ];
                savedChats.push(...defaultChats);
            }
            
            recentChatsList.innerHTML = '';
            savedChats.forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = 'chat-item';
                chatItem.innerHTML = `
                    <div class="chat-item-icon">
                        <i class="fas fa-comment"></i>
                    </div>
                    <div class="chat-item-content">
                        <div class="chat-item-title">${chat.title}</div>
                        <div class="chat-item-date">${chat.date}</div>
                    </div>
                    <button class="chat-item-menu">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                `;
                recentChatsList.appendChild(chatItem);
            });
        }

        // Override sendMessage if needed
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            // Add user message
            addChatMessage('user', message);
            input.value = '';
            input.style.height = 'auto';

            // Show typing indicator
            showTypingIndicator();

            // Send to API
            if (typeof window.sendMessage === 'function') {
                window.sendMessage(message);
            } else if (typeof API !== 'undefined') {
                const team = typeof selectedTeam !== 'undefined' ? selectedTeam : null;
                API.sendChatMessage(message, team, null)
                    .then(response => {
                        removeTypingIndicator();
                        addChatMessage('assistant', response.response || response.message || 'No response received');
                    })
                    .catch(error => {
                        removeTypingIndicator();
                        addChatMessage('error', `Error: ${error.message}`);
                    });
            } else {
                // Fallback response
                setTimeout(() => {
                    removeTypingIndicator();
                    addChatMessage('assistant', 'I understand your question about "' + message + '". Let me analyze that for you...');
                }, 1000);
            }
        }

        function addChatMessage(role, content) {
            const chatArea = document.getElementById('chat-messages-area');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            
            if (role === 'user') {
                messageDiv.style.flexDirection = 'row-reverse';
                messageDiv.innerHTML = `
                    <div class="message-bubble" style="background: #1B5E20; color: white;">
                        <div class="message-content">${content}</div>
                        <div class="message-timestamp" style="color: rgba(255,255,255,0.7);">${new Date().toLocaleTimeString()}</div>
                    </div>
                `;
            } else if (role === 'assistant') {
                messageDiv.innerHTML = `
                    <div class="message-avatar">CA</div>
                    <div class="message-bubble">
                        <div class="message-content">${content}</div>
                        <div class="message-timestamp">${new Date().toLocaleTimeString()}</div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="message-bubble" style="background: #FFEBEE; color: #C62828;">
                        <div class="message-content">${content}</div>
                    </div>
                `;
            }
            
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showTypingIndicator() {
            const chatArea = document.getElementById('chat-messages-area');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'chat-message';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = `
                <div class="message-avatar">CA</div>
                <div class="message-bubble">
                    <div class="message-content">
                        <span class="typing-dots">...</span>
                    </div>
                </div>
            `;
            chatArea.appendChild(typingDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Make functions global
        window.sendMessage = sendMessage;
        window.openTeamSelector = openTeamSelector;
        window.closeTeamSelector = closeTeamSelector;
        window.confirmTeamSelection = confirmTeamSelection;
        window.startNewChat = startNewChat;
        window.closeSidebar = closeSidebar;
    </script>
</body>
</html>
